<h4 class="lk_ttl" *ngIf="isTargetFeedbackMode$ | async">Отзывы</h4>
<h4 class="lk_ttl" *ngIf="isMyFeedbackMode$ | async">Ваши отзывы</h4>
<button class="button-close" [routerLink]="['/', 'system']">
    <img src="/img/icons/close.svg" class="button-close__img" alt="закрыть" />
</button>

<ng-container *ngIf="isTargetFeedbackMode$ | async">
    <div class="info" *ngIf="targetData$ |async as data">
        <app-contragent-card [contragent]="data.target"></app-contragent-card>
        <i class="fas fa-chevron-right fa-3x" style="align-self: center"></i>
        <app-rate [rate]="data?.rate?.summary?.avr" [size]="'96px'"></app-rate>
        <app-lk-rating-group [votes]="data?.rate?.summary_by_votes" style="flex: 1 3 auto;"></app-lk-rating-group>
    </div>
</ng-container>


<app-feedback-filter 
    class="" 
    [filters]="['status', 'type_contragent']" 
    (onChange)="changeFilters($event)">
</app-feedback-filter>



<!-- для отзывов пользователя -->
<ng-container *ngIf="isMyFeedbackMode$ | async">
    <ng-container *ngIf="{list: listFeedbackByUser$ | async } as data">
        <ng-container *ngTemplateOutlet="data?.list?.length ? userlist : emptylist; context: {$implicit:data.list}"></ng-container>
    </ng-container>
</ng-container>

<!-- для отзывов пользователя на target -->
<ng-container *ngIf="isTargetFeedbackMode$ | async">
    <ng-container *ngIf="{list: listFeedbackByTarget$ | async } as data">
        <ng-container *ngTemplateOutlet="data?.list?.length ? targetlist : emptylist; context: {$implicit:data.list}"></ng-container>
    </ng-container>
</ng-container>

<ng-template #userlist let-list>
    <div class="feedback_block zebra" *ngFor="let feedback of list">
        <!-- карточка -->
        <app-lk-simple-card [photoId]="feedback?._entity?.image_id" [title]="feedback?._entity?.title"></app-lk-simple-card>
        
        <!-- шеврон -->
        <i class="fas fa-chevron-right fa-3x" style="align-self: center"></i>

        <app-rate [rate]="feedback?._summary?.avr"></app-rate>

        <!-- шеврон -->
        <i class="fas fa-chevron-right fa-3x" style="align-self: center"></i>

        <app-lk-feedback-massage style="margin-left: 28px;" [text]="feedback?.comment?.text" [editMode]="false" [mode]="'answer'"></app-lk-feedback-massage>

        <!-- лайки -->
        <app-likes [count]="feedback?.likes?.length ?? 0"></app-likes>
        <app-likes [count]="feedback?.dislikes?.length ?? 0" [negative]="true"></app-likes>

        <!-- экшены -->
        <div class="action_block">
            <i class="fas fa-edit fa-2x action_button"></i>
            <i class="far fa-trash-alt fa-2x action_button" (click)="deleteFeedback(feedback?.id)"></i>
        </div>
    </div>
</ng-template>


<ng-template #targetlist let-list>
    <div class="feedback_block target_mode zebra" *ngFor="let feedback of list">
        <!-- карточка -->
        <app-lk-user-card *ngIf="feedback.user"  [user]="feedback.user"></app-lk-user-card>

        <!-- шеврон -->
        <i class="fas fa-chevron-right fa-3x" style="align-self: center"></i>

        <app-rate [rate]="feedback?._summary?.avr"></app-rate>

        <!-- шеврон -->
        <i class="fas fa-chevron-right fa-3x" style="align-self: center"></i>

        <app-lk-feedback-massage style="margin-left: 28px;" [text]="feedback?.comment?.text" [editMode]="false" [mode]="'answer'"></app-lk-feedback-massage>
    
        <!-- лайки -->
        <app-likes [count]="feedback?.likes?.length ?? 0"></app-likes>
        <app-likes [count]="feedback?.dislikes?.length ?? 0" [negative]="true"></app-likes>
    
        <!-- экшены -->
        <div class="action_block" *ngIf="isSelfOwner(feedback.user_id)">
            <i class="fas fa-edit fa-2x action_button"></i>
            <i class="far fa-trash-alt fa-2x action_button" (click)="deleteFeedback(feedback?.id)"></i>
        </div>
    </div>
</ng-template>


<ng-template #emptylist>
    <div class="emptylist" >
        Нет результатов отвечающих кретериям поиска
    </div>
</ng-template>